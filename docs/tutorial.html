
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tutorial &#8212; Compass 2021 documentation</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Compass Settings" href="Compass-Settings.html" />
    <link rel="prev" title="Compass User Guide" href="user-guide.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="index.html">
<p class="title">Compass</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="install.html">
  Installation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="user-guide.html">
  Compass User Guide
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p class="caption" role="heading">
 <span class="caption-text">
  Further resources:
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Compass-Settings.html">
   Compass Settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="micropooling.html">
   Micropooling
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="Compass-Postprocessing-Tutorial.html">
   Compass Postprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="notebooks/Demo.html">
     Compass Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="notebooks/Demo-micropools.html">
     Compass Micropooled Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="AWS-tutorial.html">
   AWS Tutorial
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-compass-simple">
   Running Compass (Simple)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-input">
     Example input
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-compass">
   Running Compass
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compass-settings">
   Compass Settings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#micropooling">
   Micropooling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#postprocessing">
   Postprocessing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outputs">
   Outputs
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#running-compass-simple" id="id1">Running Compass (Simple)</a></p>
<ul>
<li><p><a class="reference internal" href="#example-input" id="id2">Example input</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-compass" id="id3">Running Compass</a></p></li>
<li><p><a class="reference internal" href="#compass-settings" id="id4">Compass Settings</a></p></li>
<li><p><a class="reference internal" href="#micropooling" id="id5">Micropooling</a></p></li>
<li><p><a class="reference internal" href="#postprocessing" id="id6">Postprocessing</a></p></li>
<li><p><a class="reference internal" href="#outputs" id="id7">Outputs</a></p></li>
</ul>
</div>
<p>Broadly speaking, Compass takes in a gene expression matrix scaled for library depth
(e.g., CPM), and outputs a penalty reaction matrix, whereby
higher scores correspond to a reaction being <strong>less</strong> likely.</p>
<div class="section" id="running-compass-simple">
<h2><a class="toc-backref" href="#id1">Running Compass (Simple)</a><a class="headerlink" href="#running-compass-simple" title="Permalink to this headline">¶</a></h2>
<p>The input gene expression matrix can be either a tab-delimited text file (tsv) or a matrix market format (mtx)
containing gene expression estimates (CPM, TPM, or similar scaled units) with one row per gene, one column per sample.</p>
<p>Tab-delimited files need row and column labels corresponding to genes and sample names. Market matrix formats need a separate tab delimited file of of gene names and optionally a tab delimited file of cell names.</p>
<div class="section" id="example-input">
<h3><a class="toc-backref" href="#id2">Example input</a><a class="headerlink" href="#example-input" title="Permalink to this headline">¶</a></h3>
<p>You can find example inputs in tab-delimited format (tsv) and market matrix format (mtx) on this github repo under <a class="reference external" href="https://github.com/YosefLab/Compass/tree/master/compass/Resources/Test-Data">compass/Resources/Test-Data</a>.</p>
<p>These files will exist locally as well under the Compass install directory which can be found by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass --example-inputs --species homo_sapiens
</pre></div>
</div>
<p>Human or mouse species makes no difference for this command.</p>
</div>
</div>
<div class="section" id="running-compass">
<h2><a class="toc-backref" href="#id3">Running Compass</a><a class="headerlink" href="#running-compass" title="Permalink to this headline">¶</a></h2>
<p>Then after opening a command line in a directory with an input file “expression.tsv”, you can run Compass on the data with the following command, which will limit the number of processes to 10:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass --data expression.tsv --num-processes <span class="m">10</span> --species homo_sapiens
</pre></div>
</div>
<p>And to run Compass on mtx formatted data use the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass --data-mtx expression.mtx genes.tsv sample_names.tsv --num-processes <span class="m">10</span> --species homo_sapiens
</pre></div>
</div>
<p>Though the sample names file can be omitted, in which case the samples will be labelled by index.</p>
<p>Below is an example of the formatting for gene expression (We only show a small portion of the matrix):</p>
<img alt="_images/input_ex.png" src="_images/input_ex.png" />
<p>For the first run of Compass on a given model and media there will be overhead building up Compass’s cache.
Compass will automatically build up the cache if it is empty, but you can also manually build up the cache before running Compass with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>compass --precache --species homo_sapiens
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For every individual sample, Compass takes roughly 30 minutes
to calculate the reaction penalties (varying by machine). This can
be expedited by running more than one process at once. In addition,
Compass saves the results of all samples that it has already processed in the _tmp directory.
Therefore, Compass can also be stopped and restarted after it is done
processing a subset of samples so long as the _tmp directory is still there.</p>
</div>
</div>
<div class="section" id="compass-settings">
<h2><a class="toc-backref" href="#id4">Compass Settings</a><a class="headerlink" href="#compass-settings" title="Permalink to this headline">¶</a></h2>
<p>Compass also allows users to customize a variety of settings seen below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>usage: Compass <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--data FILE<span class="o">]</span> <span class="o">[</span>--data-mtx FILE <span class="o">[</span>FILE ...<span class="o">]]</span> <span class="o">[</span>--model MODEL<span class="o">]</span>
            <span class="o">[</span>--species SPECIES<span class="o">]</span> <span class="o">[</span>--media MEDIA<span class="o">]</span> <span class="o">[</span>--output-dir DIR<span class="o">]</span>
            <span class="o">[</span>--temp-dir DIR<span class="o">]</span> <span class="o">[</span>--torque-queue QUEUE<span class="o">]</span> <span class="o">[</span>--num-processes N<span class="o">]</span>
            <span class="o">[</span>--lambda F<span class="o">]</span> <span class="o">[</span>--num-threads N<span class="o">]</span> <span class="o">[</span>--and-function FXN<span class="o">]</span>
            <span class="o">[</span>--select-reactions FILE<span class="o">]</span> <span class="o">[</span>--num-neighbors N<span class="o">]</span>
            <span class="o">[</span>--symmetric-kernel<span class="o">]</span> <span class="o">[</span>--input-weights FILE<span class="o">]</span>
            <span class="o">[</span>--penalty-diffusion MODE<span class="o">]</span> <span class="o">[</span>--no-reactions<span class="o">]</span>
            <span class="o">[</span>--calc-metabolites<span class="o">]</span> <span class="o">[</span>--precache<span class="o">]</span> <span class="o">[</span>--input-knn FILE<span class="o">]</span>
            <span class="o">[</span>--output-knn FILE<span class="o">]</span> <span class="o">[</span>--latent-space FILE<span class="o">]</span> <span class="o">[</span>--only-penalties<span class="o">]</span>
            <span class="o">[</span>--list-genes FILE<span class="o">]</span>
</pre></div>
</div>
<p>See the instructions
<a class="reference internal" href="Compass-Settings.html"><span class="doc">here</span></a>
for an in depth tutorial on using Compass’s settings</p>
</div>
<div class="section" id="micropooling">
<h2><a class="toc-backref" href="#id5">Micropooling</a><a class="headerlink" href="#micropooling" title="Permalink to this headline">¶</a></h2>
<p>The Compass algorithm can be very computationally intensive, especially for large datasets, but with micropooling/clustering techniques you can reduce the computing time by an order of magnitude.
Compass comes with a micropooling algorithm built in, based on a reimplementation of microclustering from <a class="reference external" href="https://github.com/yoseflab/vision">VISION</a>. To enable microclustering you can specify a microcluster size as below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Compass --microcluster-size <span class="m">10</span> <span class="o">[</span>other options<span class="o">]</span>
</pre></div>
</div>
<p>In general cluster size presents a tradeoff between runtime and granularity as larger clusters can make analysis more sensitive but will take longer to process the samples, so a microcluster size as small as computationally feasible is recommended. There are more details on micropooling with Compass <a class="reference internal" href="micropooling.html"><span class="doc">here</span></a>.</p>
<p>Alternatively, any other method of aggregating cells into fewer representatives can be used such as <a class="reference external" href="https://github.com/tanaylab/metacell">metacell</a>.</p>
</div>
<div class="section" id="postprocessing">
<h2><a class="toc-backref" href="#id6">Postprocessing</a><a class="headerlink" href="#postprocessing" title="Permalink to this headline">¶</a></h2>
<p>Once Compass has finished running, we apply several steps of
postprocessing to the data. Mainly, the postprocessing converts reaction penalties (where
high values correspond to low likelihood reactions) to reaction scores
(where high values correspond to likely reactions).</p>
</div>
<div class="section" id="outputs">
<h2><a class="toc-backref" href="#id7">Outputs</a><a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h2>
<p>When Compass has completed, the outputs for all samples are stored in a
tab delimited file <code class="docutils literal notranslate"><span class="pre">reactions.tsv</span></code> in the specified output directory
(<code class="docutils literal notranslate"><span class="pre">.</span></code> directory when running Compass by default).</p>
<p>Below is an example of the output matrix:</p>
<img alt="_images/output_ex.png" src="_images/output_ex.png" />
<p>To get more context on what the reaction identifiers are, you can visit <a class="reference external" href="https://www.vmh.life/#home">virtual metabolic human</a> or <a class="reference external" href="https://github.com/YosefLab/Compass/tree/master/compass/Resources/Recon2_export">the resources directory of Compass</a> where there are several csv’s which include information on the reactions in Recon2.</p>
<p><em>Note: While Compass is running, it will store partial results for
each sample in the _tmp directory/ (or the directory following --temp-dir)</em></p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="user-guide.html" title="previous page">Compass User Guide</a>
    <a class='right-next' id="next-link" href="Compass-Settings.html" title="next page">Compass Settings</a>

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Yosef Lab.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.2.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>